---
title: "è‡ªè£½ Chai Plugin"
author: "Yuren Ju"
date: 2020-04-11T04:43:21.590Z
lastmod: 2023-06-06T13:43:20+08:00
categories: [tech]

description: ""

subtitle: "ä½œç‚ºç¶“å¸¸ä½¿ç”¨ Mocha/Chai çš„é–‹ç™¼è€…ï¼Œæœ‰æ™‚é‚„æ˜¯è¦ºå¾— Chai çš„åŠŸèƒ½æ²’è¾¦æ³•æ»¿è¶³éœ€æ±‚ã€‚é›–ç„¶çŸ¥é“ chai å¯ä»¥è‡ªè¡Œæ’°å¯« plugin ä¾†æ›´æ”¹é è¨­è¡Œç‚ºï¼Œä¸éä¸€ç›´éƒ½æ²’ç ”ç©¶è¦æ€éº¼åšï¼Œä¸éé€™æ¬¡æ­£å¥½æœ‰æ©ŸæœƒèªçœŸè®€äº† Chai çš„æ–‡ä»¶å¾Œå¯«äº†å°ˆæ¡ˆè¦ç”¨çš„ plugin å¾Œä¾†åˆ†äº«ä¸€ä¸‹åšæ³•ã€‚"

images:
  - "/posts/2020-04-11_è‡ªè£½-chai-plugin/images/1.jpg"
  - "/posts/2020-04-11_è‡ªè£½-chai-plugin/images/2.png"
  - "/posts/2020-04-11_è‡ªè£½-chai-plugin/images/3.png"
  - "/posts/2020-04-11_è‡ªè£½-chai-plugin/images/4.png"
  - "/posts/2020-04-11_è‡ªè£½-chai-plugin/images/5.png"
  - "/posts/2020-04-11_è‡ªè£½-chai-plugin/images/6.png"
  - "/posts/2020-04-11_è‡ªè£½-chai-plugin/images/7.png"
  - "/posts/2020-04-11_è‡ªè£½-chai-plugin/images/8.png"
  - "/posts/2020-04-11_è‡ªè£½-chai-plugin/images/9.png"
  - "/posts/2020-04-11_è‡ªè£½-chai-plugin/images/10.png"
---

![image](/posts/2020-04-11_è‡ªè£½-chai-plugin/images/1.jpg#layoutTextWidth)
Credit: [Github repo](https://github.com/chaijs)

ä½œç‚ºç¶“å¸¸ä½¿ç”¨ Mocha/Chai çš„é–‹ç™¼è€…ï¼Œæœ‰æ™‚é‚„æ˜¯è¦ºå¾— Chai çš„åŠŸèƒ½æ²’è¾¦æ³•æ»¿è¶³éœ€æ±‚ã€‚é›–ç„¶çŸ¥é“ chai å¯ä»¥è‡ªè¡Œæ’°å¯« plugin ä¾†æ›´æ”¹é è¨­è¡Œç‚ºï¼Œä¸éä¸€ç›´éƒ½æ²’ç ”ç©¶è¦æ€éº¼åšï¼Œä¸éé€™æ¬¡æ­£å¥½æœ‰æ©ŸæœƒèªçœŸè®€äº† Chai çš„æ–‡ä»¶å¾Œå¯«äº†å°ˆæ¡ˆè¦ç”¨çš„ plugin å¾Œä¾†åˆ†äº«ä¸€ä¸‹åšæ³•ã€‚

é€™æ¬¡ä»‹ç´¹çš„ç¯„ä¾‹æœƒæ”¾åœ¨ä»¥ä¸‹çš„ github repository å¯ä»¥åƒè€ƒä¸€ä¸‹ã€‚

[yurenju/chai-plugin-example](https://github.com/yurenju/chai-plugin-example)

### å®šç¾© eq æ–°åŠŸèƒ½

ä¸çŸ¥é“å¤§å®¶é–‹å§‹ç”¨ JavaScript æ–°çš„å…§å»ºå‹æ…‹ BigInt äº†æ²’ï¼Ÿåœ¨ node.js v10 ä¹Ÿé–‹å§‹æ”¯æ´ï¼Œç†è«–ä¸Šå·²ç¶“å¯ä»¥å»£æ³›ä½¿ç”¨äº†ã€‚ä½¿ç”¨æ™‚è·Ÿä¸€èˆ¬æ•´æ•¸ä¸€æ¨£ï¼Œä½†æ˜¯è¦åœ¨å¾Œç¶´åŠ å€‹ `n` ä»£è¡¨å®ƒæ˜¯ BigIntï¼Œæ¯”å¦‚èªª 100n å°±æ˜¯å‹æ…‹ç‚º BigInt çš„æ•´æ•¸ 100ã€‚

ä½†æ˜¯å¦‚æœä½ å˜—è©¦è‘—åœ¨ Chai è£¡é¢æ’°å¯«å¦‚ä¸‹çš„æ¸¬è©¦ç¯„ä¾‹æ™‚ï¼š

![image](/posts/2020-04-11_è‡ªè£½-chai-plugin/images/2.png#layoutTextWidth)

æŒ‰ç…§é‚è¼¯åœ¨ç¬¬äºŒå€‹æ¸¬è©¦æ‡‰è©²æœƒå‡ºéŒ¯ï¼Œä¸¦ä¸”é¡¯ç¤º 30n ä¸ç­‰æ–¼ 20nï¼Œä½†å¯¦éš›ä¸Šå‰‡æœƒä¸Ÿå‡ºä¸€å€‹è«åå…¶å¦™çš„éŒ¯èª¤è¨Šæ¯ï¼š

![image](/posts/2020-04-11_è‡ªè£½-chai-plugin/images/3.png#layoutTextWidth)

åŸå› å…¶å¯¦å°±æ˜¯ Chai å…§éƒ¨é‹ä½œæ²’æœ‰è€ƒæ…®åˆ° BigInt çš„é‚è¼¯ã€‚è€Œç­‰å¾…å®˜æ–¹æ”¯æ´[ç›®å‰çœ‹èµ·ä¾†æ˜¯é™é™ç„¡æœŸ](https://github.com/chaijs/chai/issues/1321)ï¼Œä¸éæˆ‘å€‘å¯ä»¥åˆ©ç”¨ Chai plugin å¾ˆç°¡å–®çš„å°±å¯ä»¥è§£æ±ºé€™å€‹å•é¡Œã€‚

Chai çš„æ¡†æ¶æä¾›äº†è¨±å¤šæ›´æ”¹åŸå…ˆé‚è¼¯çš„æ–¹æ³•ã€‚é¦–å…ˆæ–°å¢ä¸€å€‹ helper æ¨¡çµ„ï¼Œä¸¦ä¸”åˆ©ç”¨ `overwriteMethod` ä¾†ä¿®æ”¹ `eq` åŸæœ¬çš„é‚è¼¯ï¼š

![image](/posts/2020-04-11_è‡ªè£½-chai-plugin/images/4.png#layoutTextWidth)

å…¶ä¸­æœ‰å¹¾å€‹åƒæ•¸ï¼š

- this.\_obj: é€™æ˜¯åŸæœ¬çš„ expect() è£¡é¢å‚³å…¥çš„åƒæ•¸
- this.assert: ç”¨ä¾†åˆ¤æ–·æ­£ç¢ºèˆ‡å¦ã€è¨Šæ¯ä»¥åŠè¦æ¯”è¼ƒçš„å…©å€‹æ•¸å€¼
- \_super: åŸæœ¬çš„åˆ¤æ–·å¼ï¼Œå¦‚æœä¸æ˜¯æˆ‘å€‘è¦è™•ç†çš„ç‹€æ³å‰‡ç”¨åŸæœ¬çš„è™•ç†æ–¹æ³•

å¯«å®Œ helper ä¹‹å¾Œåˆ©ç”¨ `chai.use()` å°±å¯ä»¥å°‡å¯«å¥½çš„æ¨¡çµ„æ³¨å…¥ chai ç•¶ä¸­ï¼š

![image](/posts/2020-04-11_è‡ªè£½-chai-plugin/images/5.png#layoutTextWidth)

é€™æ¨£éŒ¯èª¤è¨Šæ¯å°±æœƒæ¸…æ¥šå¾ˆå¤šäº†

![image](/posts/2020-04-11_è‡ªè£½-chai-plugin/images/6.png#layoutTextWidth)

### æ–°å¢å‡½å¼

é™¤äº†å¯ä»¥æ”¹å¯«åŸæœ¬é‹ä½œé‚è¼¯å¤–ï¼Œä¹Ÿå¯ä»¥æ–°å¢è‡ªè¨‚å‡½å¼ä¾†æ“´å±•åŠŸèƒ½ï¼Œæ¯”å¦‚èªªæˆ‘å€‘å°ˆæ¡ˆè£¡é¢æœ‰å€‹ç‰¹æ®Šçš„å›å‚³æ ¼å¼ï¼Œæˆ‘å€‘å¸Œæœ›é©—è­‰è£¡é¢çš„æŸå€‹é™£åˆ—è£¡ç‰¹å®šæ•¸å€¼æ˜¯ä»€éº¼ã€‚

åœ¨é€™å€‹ä¾‹å­è£é¢ï¼Œæˆ‘å€‘å¸Œæœ›é©—è­‰ response.logs è£¡é¢æœ‰å€‹ event æ˜¯ SwapTokenï¼Œè€Œä¸” log.args è£¡é¢æœ‰å…©å€‹å±¬æ€§ fromToken, toToken åˆ†åˆ¥æ˜¯ç‰¹å®šæ•¸å€¼ã€‚

![image](/posts/2020-04-11_è‡ªè£½-chai-plugin/images/7.png#layoutTextWidth)

åœ¨ Chai æˆ‘å€‘åœ¨æ²’æœ‰ä»»ä½• helper ä¹‹å‰ä¾ç„¶å¯ä»¥å®Œæˆé€™é …å·¥ä½œï¼Œä½†æ˜¯å¦‚æœæœ‰ helper ä¹‹å¾Œï¼Œæˆ‘å€‘å¯ä»¥æŠŠå®ƒå¯«æˆæ›´ç‚ºç²¾ç°¡ã€‚æ¯”å¦‚èªªæˆ‘å€‘å…ˆè¨­å®šé æœŸç›®æ¨™æ˜¯å°‡èªæ³•ä¿®æ­£æˆé€™æ¨£ï¼š

![image](/posts/2020-04-11_è‡ªè£½-chai-plugin/images/8.png#layoutTextWidth)

é€™æ¨£çš„èªæ³•æ›´å®¹æ˜“é–±è®€ï¼Œéœ€è¦çš„è¡Œæ•¸ä¹Ÿè¼ƒå°‘ã€‚æ¥è‘—æˆ‘å€‘å°±å¯ä»¥ä¾ç…§æˆ‘å€‘æƒ³è¦é”æˆçš„æ•ˆæœåˆ©ç”¨ `addMethod()` ç‚º Chai æ–°å¢ emit ä»¥åŠ withArgs å‡½å¼ï¼š
![image](/posts/2020-04-11_è‡ªè£½-chai-plugin/images/9.png#layoutTextWidth)
å°±å³å¯é”æˆç”¨æ›´ç°¡æ½”çš„èªæ³•é”æˆç›¸åŒæ•ˆæœçš„é©—è­‰ã€‚

![image](/posts/2020-04-11_è‡ªè£½-chai-plugin/images/10.png#layoutTextWidth)

é™¤äº†é€™å…©å€‹å‡½å¼å¤–ï¼ŒChai é‚„æä¾›äº†ä¸å°‘åŠŸèƒ½å¯ä»¥æ“´å±•åŠŸèƒ½ï¼Œæœ‰èˆˆè¶£çš„å¯ä»¥ç ”è®€ä¸€ä¸‹å®˜æ–¹æ–‡ä»¶ã€‚

[Core Plugin Concepts](https://www.chaijs.com/guide/plugins/)

é€™æ¬¡çš„ç¯„ä¾‹éƒ½å¯ä»¥åœ¨ä»¥ä¸‹çš„ Github repository æ‰¾åˆ°ï¼Œæƒ³è¦è‡ªå·±å¯« Chai helper å¯ä»¥è©¦è©¦ã€‚ç•¶æ¸¬è©¦å¯«èµ·ä¾†æ›´ç°¡æ½”æ˜“æ‡‚å¾Œï¼Œå¿ƒæƒ…æ„‰å¿«èµ·ä¾†æ„Ÿè¦ºé–‹ç™¼æ•ˆç‡å°±æ›´é«˜äº†å‘¢ ğŸ¤£

# PRD：文章歸檔機制與目錄結構重組

**日期：** 2026-02-07
**狀態：** 草稿
**基於研究：** `docs/research/2026-02-07-post-archiving-and-directory-restructure.md`

## 1. 簡介/概述

部落格自 2000 年起累積了 1,486 篇文章，其中 94%（1,396 篇）為 2019 年及以前的舊文章。這些早期文章品質參差不齊，與近年精心撰寫的內容混在一起，降低了整體瀏覽體驗。同時，所有文章目錄平鋪在同一個資料夾中，日常管理也變得困難。

本功能將引入「文章歸檔」機制，將舊文章從主列表移至獨立的 Archives 區域，同時重新組織檔案目錄結構，讓作者能更有效率地管理內容。

## 2. 目標

1. **提升瀏覽體驗：** 主文章列表從 1,486 篇精簡至 90 篇（2020 年以後），讓讀者更容易找到優質內容
2. **保留舊文章可存取性：** 歸檔文章仍可透過 Archives 頁面瀏覽，且所有文章的 URL 維持不變
3. **改善目錄管理效率：** 透過分組目錄結構，讓作者新增和編輯文章時不再需要在近 1,500 個目錄中尋找目標

## 3. 使用者故事

### 讀者

- 作為讀者，我希望文章列表只顯示近年的高品質文章，這樣我可以更快找到值得閱讀的內容
- 作為讀者，我希望在列表底部能找到舊文章的入口，如果我對早期內容有興趣的話
- 作為讀者，我希望在 tech 或 life 分類頁面也只看到近年的文章，但如果想看舊的分類文章，也有入口可以找到
- 作為讀者，如果我已經有某篇舊文章的連結，我希望它仍然能正常打開

### 作者

- 作為作者，我希望新增文章時只需要在當年的年份目錄中操作，而不用在近 1,500 個目錄中尋找位置
- 作為作者，我希望每年只需新增一個年份目錄，就能開始寫新文章

## 4. 功能需求

### 4.1 歸檔規則

1. 系統必須將 2019 年（含）以前的文章標記為歸檔文章
2. 歸檔的判定基於文章所在的分組目錄名稱（`archives`），而非文章日期
3. 所有文章（含歸檔文章）的 URL 路徑必須維持不變（`/posts/{slug}`）

### 4.2 主文章列表（/posts）

4. 主文章列表必須排除歸檔文章，只顯示非歸檔文章
5. 主文章列表底部必須顯示一個 Archives 入口連結，引導讀者前往歸檔文章頁面

### 4.3 分類頁面（/tech、/life）

6. 分類頁面必須排除歸檔文章，只顯示該分類下的非歸檔文章
7. 每個分類頁面底部必須顯示一個「更多歸檔文章」入口連結，連結到該分類的歸檔文章頁面
8. tech 分類的歸檔入口只連結到 tech 歸檔文章；life 分類的歸檔入口只連結到 life 歸檔文章

### 4.4 Archives 頁面（`/[locale]/archives`）

9. 系統必須提供一個獨立的 Archives 頁面（`/[locale]/archives`），列出所有歸檔文章
10. Archives 頁面的文章排列方式與現有列表一致（按年份分組，年份由新到舊）
11. Archives 頁面必須支援多語言（zh、ja、en），與現有頁面一致
12. 根路徑 `/archives` 必須 redirect 到 `/zh/archives`，與現有路由慣例一致

### 4.5 分類歸檔頁面（`/[locale]/archives/tech`、`/[locale]/archives/life`）

13. 系統必須提供按分類瀏覽歸檔文章的頁面（`/[locale]/archives/tech`、`/[locale]/archives/life`）
14. 分類歸檔頁面的排列方式與 Archives 主頁一致

### 4.6 目錄結構

15. 文章檔案必須從單層平鋪改為兩層結構：第一層為分組目錄，第二層為文章目錄
16. 分組目錄名稱可以是任意名稱（年份如 `2026`、或 `archives`）
17. 程式讀取文章時必須自動遍歷分組目錄，對上層應用透明
18. 2019 年（含）以前的文章移入 `archives/` 分組目錄
19. 2020 年（含）以後的文章按年份移入對應的年份分組目錄（`2020/`、`2021/`、...、`2026/`）

## 5. 非目標（超出範圍）

- **手動歸檔標記：** 不提供在 frontmatter 中手動標記個別文章為歸檔/非歸檔的功能
- **搜尋功能：** 不為歸檔文章提供搜尋功能
- **歸檔文章分頁：** Archives 頁面不需要分頁，一次列出所有歸檔文章
- **導覽列變更：** 不在 Navbar 中加入 Archives 連結
- **歸檔文章內的子分組：** `archives/` 目錄內部不再按年份細分

## 6. 設計考量

### Archives 入口連結

- 位於文章列表最後一個年份區塊之後
- 文案參考：「查看歸檔文章」（zh）、「アーカイブ記事を見る」（ja）、「View archived posts」（en）
- 視覺上應與列表有所區隔，但不過於搶眼

### 分類頁面的歸檔入口

- 位於該分類文章列表底部
- 文案參考：「更多歸檔文章」（zh）、「その他のアーカイブ記事」（ja）、「More archived posts」（en）
- 點擊後導向該分類的歸檔文章列表（如 `/zh/archives/tech`、`/zh/archives/life`）

### Archives 頁面

- 使用與現有文章列表相同的 `PostsList` 元件渲染
- 頁面標題：「歸檔文章」（zh）、「アーカイブ」（ja）、「Archives」（en）

## 7. 技術考量

- 根據研究文件分析，核心改動集中在 `lib/posts.ts` 的目錄掃描邏輯，從一層改為兩層
- 文章的 slug 來自目錄名稱或 frontmatter，與分組目錄無關，因此 URL 不受影響
- 所有依賴 `getAllPostMetadata()` 的下游功能（RSS、封面圖片、分類頁面等）在底層函式修改後將自動正確運作
- 需撰寫遷移腳本處理 1,486 篇文章的目錄搬遷
- 需確認 Markdown 中使用絕對路徑引用圖片的文章（如 `/posts/slug/images/photo.jpg`）在搬遷後仍能正確顯示

## 8. 驗收標準

1. 主文章列表（/posts）只顯示 2020 年以後的文章（約 90 篇）
2. 分類頁面（/tech、/life）只顯示 2020 年以後的該分類文章
3. 主文章列表和分類頁面底部有歸檔入口連結
4. Archives 頁面能正確列出所有 2019 年及以前的文章（1,396 篇）
5. 分類歸檔頁面能正確按分類篩選歸檔文章
6. 所有文章的 URL 維持不變，已存在的連結不會斷掉
7. 多語言（zh、ja、en）頁面都能正確顯示
8. RSS feed 正確運作
9. 建置（`npm run build`）成功完成，無錯誤

## 9. 開放問題

1. ~~歸檔文章是否應該出現在 RSS feed 中？~~ （保持現有邏輯不變）
2. ~~Archives 頁面的 URL 路徑確認~~ → 採用頂層路由方案：`/archives`、`/archives/tech`、`/archives/life`

## 10. 參考資料

- **研究文件：** `docs/research/2026-02-07-post-archiving-and-directory-restructure.md`
- **現有程式碼：** `lib/posts.ts`、`components/PostsList.tsx`、`components/pages/PostsPage.tsx`

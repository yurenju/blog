# PRD: 情境式導覽 - 基於讀者類別偏好的動態導覽系統

## 簡介/概述

基於 `docs/research/2025-10-11-category-based-navigation.md` 中的研究發現,本功能旨在優化部落格的導覽體驗,根據讀者當前瀏覽的頁面情境,動態調整導覽列顯示的內容。

### 背景

目前網站的導覽列在所有頁面都顯示「全部文章」連結,但研究觀察發現讀者傾向專注於單一類別(科技或生活),很少跨類別閱讀。這導致「全部文章」連結對於專注某一類別的讀者來說可能不是最有用的選項。

### 解決方案

採用**方案五(頁面自行渲染 Navbar)**：將 Navbar 從全域 Layout 移除,改為在各個頁面元件中直接渲染 Navbar,並根據頁面類型傳入對應的 category 參數。這樣可以實現：

- 當讀者在科技文章或科技分類頁時,顯示「所有科技文章」連結
- 當讀者在生活文章或生活分類頁時,顯示「所有生活記事」連結
- 在首頁、關於、訂閱等其他頁面,不顯示類別連結
- 保留 `/posts` 路徑但不在導覽中顯示連結

### 主要類別邏輯

對於同時屬於多個分類的文章(目前有 14 篇),採用「主要類別」邏輯:
- 保持文章的多分類結構(categories 陣列)
- 將 `categories[0]`(第一個分類)視為主要類別
- 導覽顯示基於主要類別決定

## 目標

1. **提升使用者體驗**: 提供更符合讀者閱讀情境的導覽選項,減少資訊過載
2. **簡化程式架構**: 將 Navbar 改為純 props 驅動的 presentational component,提高可維護性
3. **類型安全**: 透過明確的 props 傳遞,在編譯時期就能發現錯誤
4. **保持靈活性**: 保留 `/posts` 路徑供未來使用,不影響 SEO

## 使用者故事

### 故事 1: 科技讀者的探索旅程
**身為**科技內容的讀者
**我想要**在閱讀科技文章時,方便地探索更多科技文章
**以便**深入了解相關技術主題,而不被生活類文章干擾

**驗收標準**:
- 當我在科技分類頁(`/tech`)時,導覽列顯示「所有科技文章」連結
- 當我點擊科技文章進入文章詳細頁時,導覽列仍然顯示「所有科技文章」
- 點擊「所有科技文章」會回到 `/tech` 頁面
- 不會看到生活類文章的連結

### 故事 2: 生活讀者的閱讀體驗
**身為**對生活記事感興趣的讀者
**我想要**在閱讀生活文章時,能夠快速瀏覽其他生活文章
**以便**持續閱讀感興趣的生活主題內容

**驗收標準**:
- 當我在生活分類頁(`/life`)時,導覽列顯示「所有生活記事」連結
- 當我點擊生活文章進入文章詳細頁時,導覽列仍然顯示「所有生活記事」
- 點擊「所有生活記事」會回到 `/life` 頁面
- 不會看到科技類文章的連結

### 故事 3: 新訪客的首次瀏覽
**身為**第一次訪問網站的新讀者
**我想要**在首頁先了解網站的主題分類
**以便**選擇我感興趣的內容類別開始閱讀

**驗收標準**:
- 在首頁時,導覽列不顯示「全部文章」或類別連結
- 首頁本身提供「科技」和「生活」兩個按鈕供選擇
- 導覽保持簡潔,不分散注意力

### 故事 4: 多語系讀者的使用體驗
**身為**使用日文或英文介面的讀者
**我想要**看到正確翻譯的導覽文字
**以便**理解各個連結的用途

**驗收標準**:
- 繁體中文顯示「所有科技文章」、「所有生活記事」
- 日文顯示對應的翻譯文字
- 英文顯示對應的翻譯文字
- 語言切換時,導覽文字同步更新

## 功能需求

### FR1: Navbar 元件重構

**FR1.1**: Navbar 元件必須接受兩個必填參數:
- `locale: Locale` - 當前語系
- `category: Category | null` - 當前頁面的類別,`null` 表示不顯示類別連結

**FR1.2**: Navbar 元件必須移除所有 client-side 路徑判斷邏輯(如 `usePathname`)

**FR1.3**: Navbar 元件必須根據 `category` 參數決定是否顯示類別連結:
- `category === 'tech'`: 顯示「所有科技文章」連結,指向 `/{locale}/tech`
- `category === 'life'`: 顯示「所有生活記事」連結,指向 `/{locale}/life`
- `category === null`: 不顯示任何類別連結

**FR1.4**: Navbar 元件必須保持現有的其他導覽項目:
- 首頁連結
- 關於連結
- 訂閱連結
- 主題切換按鈕
- 語言切換器

### FR2: Layout 架構調整

**FR2.1**: `app/[locale]/layout.tsx` 必須移除 `<Navbar />` 元件

**FR2.2**: Layout 必須保持 `max-w-3xl` 和 `lang` 屬性的設定

### FR3: 頁面元件更新

**FR3.1 文章詳細頁** (`components/pages/PostDetailPage.tsx`):
- 必須在頁面頂部渲染 `<Navbar locale={locale} category={mainCategory} />`
- `mainCategory` 必須取自 `postData.categories[0] || null`
- 如果文章沒有分類,傳入 `null`

**FR3.2 類別頁面** (`components/pages/CategoryPage.tsx`):
- 必須在頁面頂部渲染 `<Navbar locale={locale} category={category} />`
- `category` 參數直接使用從頁面 props 傳入的值

**FR3.3 首頁** (`components/pages/HomePage.tsx`):
- 必須在頁面頂部渲染 `<Navbar locale={locale} category={null} />`

**FR3.4 靜態頁面** (`components/pages/StaticMarkdownPage.tsx`):
- 必須在頁面頂部渲染 `<Navbar locale={locale} category={null} />`
- 適用於「關於」和「訂閱」頁面

**FR3.5 全部文章頁面** (`components/pages/PostsPage.tsx`):
- 必須在頁面頂部渲染 `<Navbar locale={locale} category={null} />`
- 不顯示類別連結,保持路徑可訪問但不在導覽中突出

### FR4: 多語系翻譯

**FR4.1**: 必須在 `lib/i18n/translations.ts` 的 `nav` 部分新增以下翻譯鍵:

繁體中文 (`zh`):
- `allTechPosts: '所有科技文章'`
- `allLifePosts: '所有生活記事'`

日文 (`ja`):
- `allTechPosts: 'すべての技術記事'`
- `allLifePosts: 'すべての生活記事'`

英文 (`en`):
- `allTechPosts: 'All Tech Posts'`
- `allLifePosts: 'All Life Posts'`

**FR4.2**: 必須保留現有的 `allPosts` 翻譯鍵(供 PostsPage 使用)

### FR5: 多分類文章處理

**FR5.1**: 系統必須將 `categories` 陣列的第一個元素(`categories[0]`)視為文章的主要類別

**FR5.2**: 系統必須保持文章 frontmatter 中的多分類結構,不移除任何分類

**FR5.3**: 文章詳細頁的導覽必須基於主要類別顯示對應的類別連結

**FR5.4**: 類別列表頁面必須繼續使用 `categories.includes()` 邏輯,允許多分類文章出現在多個類別頁面

## 非目標(超出範圍)

1. **Footer 元件**: 本次不建立 Footer 或「瀏覽全部文章」的額外入口
2. **多分類文章的自動調整**: 不由 AI 自動調整 14 篇多分類文章的 categories 順序(將在實作計畫中開任務讓使用者手動調整)
3. **路由結構變更**: 不修改 `/posts/[slug]` 的路由結構
4. **分析追蹤**: 不在此功能中加入 GA 或其他分析工具的事件追蹤
5. **A/B 測試**: 不實作 A/B 測試機制
6. **個人化推薦**: 不根據使用者歷史行為個人化導覽

## 設計考量

### UI/UX 要求

**一致性**:
- 導覽列的視覺樣式必須與現有設計保持一致
- 使用現有的 Button 元件和 `variant="ghost"` 樣式
- 保持項目之間的 `•` 分隔符號

**反應式設計**:
- 導覽列必須在各種螢幕尺寸下正常運作
- 保持現有的 `max-w-7xl mx-auto px-4` 容器樣式

**無障礙性**:
- 所有導覽連結必須保持可鍵盤操作
- 連結文字必須清晰描述目的地

### 導覽邏輯流程圖

```
訪客進入頁面
    ↓
判斷頁面類型
    ↓
┌───────────────┬────────────────┬──────────────┬────────────────┐
│   文章詳細頁   │   類別頁面      │    首頁      │   靜態頁面     │
│               │                │              │   (關於/訂閱)   │
└───────┬───────┴────────┬───────┴──────┬───────┴────────┬───────┘
        │                │              │                │
    取得文章的         直接使用         傳入           傳入
    categories[0]      頁面的 category   null           null
        │                │              │                │
        └────────────────┴──────────────┴────────────────┘
                            │
                    Navbar 渲染
                            │
            ┌───────────────┴───────────────┐
            │                               │
      category !== null              category === null
            │                               │
    顯示對應類別連結                    不顯示類別連結
    (所有科技文章/                      (僅顯示首頁、
     所有生活記事)                       關於、訂閱)
```

## 技術考量

### 架構變更

**優勢**:
- 簡化 Navbar 為純 presentational component
- 移除 client-side 路徑判斷,提升效能
- 類型安全,編譯時期錯誤檢查
- 符合 React 組合模式,提高可維護性

**風險控制**:
- 所有頁面元件都需要修改(約 5-6 個檔案)
- 必須確保每個頁面都加入 Navbar,避免遺漏

### 相依性

**必須保持的相依**:
- `components/ui/button` - Button 元件
- `components/ThemeToggleButton` - 主題切換
- `components/LanguageSwitcher` - 語言切換
- `lib/i18n/translations` - 翻譯系統
- `lib/posts` - Category 型別定義

**不需要的相依** (可移除):
- `next/navigation` 的 `usePathname` (從 Navbar 中移除)

### 向後相容性

**URL 結構**:
- `/posts` 路徑必須保持可訪問(向後相容)
- 所有現有的文章 URL 不變
- SEO 不受影響

**多語系**:
- 現有的語系切換機制不變
- 語系路徑結構 (`/zh`, `/ja`, `/en`) 保持一致

## 驗收標準

### AC1: 導覽顯示正確性

**測試情境 1.1**: 科技分類頁
- 訪問 `/zh/tech`
- 導覽列顯示「所有科技文章」連結
- 點擊連結停留在 `/zh/tech`

**測試情境 1.2**: 生活分類頁
- 訪問 `/zh/life`
- 導覽列顯示「所有生活記事」連結
- 點擊連結停留在 `/zh/life`

**測試情境 1.3**: 科技文章詳細頁
- 訪問任一科技文章(主要類別為 `tech`)
- 導覽列顯示「所有科技文章」連結
- 點擊連結跳轉至 `/zh/tech`

**測試情境 1.4**: 生活文章詳細頁
- 訪問任一生活文章(主要類別為 `life`)
- 導覽列顯示「所有生活記事」連結
- 點擊連結跳轉至 `/zh/life`

**測試情境 1.5**: 多分類文章
- 訪問 `categories: [tech, life]` 的文章
- 導覽列顯示「所有科技文章」(基於第一個分類)
- 訪問 `categories: [life, tech]` 的文章
- 導覽列顯示「所有生活記事」(基於第一個分類)

**測試情境 1.6**: 首頁
- 訪問 `/zh`
- 導覽列不顯示「所有科技文章」或「所有生活記事」
- 僅顯示「首頁」、「關於」、「訂閱」

**測試情境 1.7**: 關於頁面
- 訪問 `/zh/about`
- 導覽列不顯示類別連結
- 僅顯示基本導覽項目

**測試情境 1.8**: 訂閱頁面
- 訪問 `/zh/subscription`
- 導覽列不顯示類別連結

**測試情境 1.9**: 全部文章頁面
- 訪問 `/zh/posts`
- 頁面正常顯示所有文章列表
- 導覽列不顯示類別連結

### AC2: 多語系支援

**測試情境 2.1**: 日文介面
- 切換語言至日文
- 在 `/ja/tech` 看到「すべての技術記事」
- 在 `/ja/life` 看到「すべての生活記事」

**測試情境 2.2**: 英文介面
- 切換語言至英文
- 在 `/en/tech` 看到「All Tech Posts」
- 在 `/en/life` 看到「All Life Posts」

**測試情境 2.3**: 語言切換連續性
- 在科技文章頁面切換語言
- 導覽列的類別連結文字正確更新
- 連結 URL 包含正確的語系前綴

### AC3: 現有功能不受影響

**測試情境 3.1**: 主題切換
- 在任何頁面點擊主題切換按鈕
- 深色/淺色模式正常切換
- 導覽列樣式正確適應主題

**測試情境 3.2**: 語言切換器
- 在任何頁面使用語言切換器
- 語言正確切換
- 導覽列保持在頁面頂部

**測試情境 3.3**: 響應式設計
- 在不同螢幕尺寸測試(桌面、平板、手機)
- 導覽列正常顯示且可操作
- 無水平滾動條

### AC4: 程式碼品質

**測試情境 4.1**: TypeScript 編譯
- 執行 `npm run build`
- 無 TypeScript 錯誤
- 所有 Navbar 的 category props 類型正確

**測試情境 4.2**: 靜態匯出
- 執行 `npm run build`
- 成功生成靜態 HTML 檔案
- 所有頁面都包含 Navbar HTML

**測試情境 4.3**: 開發模式
- 執行 `npm run dev`
- Hot reload 正常運作
- 無 console 錯誤

## 開放問題

無。所有需求已明確定義。

## 參考資料

1. **研究文件**: `docs/research/2025-10-11-category-based-navigation.md`
   - 包含完整的方案分析和比較
   - 技術實作建議和程式碼範例
   - 使用者體驗分析

2. **現有程式碼**:
   - `components/Navbar.tsx` - 當前導覽列實作
   - `app/[locale]/layout.tsx` - Layout 架構
   - `lib/i18n/translations.ts` - 翻譯系統
   - `lib/posts.ts` - 文章和分類邏輯

3. **相關元件**:
   - `components/pages/*` - 各頁面元件
   - `components/ThemeToggleButton.tsx` - 主題切換
   - `components/LanguageSwitcher.tsx` - 語言切換

---

**文件版本**: 1.0
**建立日期**: 2025-10-11
**最後更新**: 2025-10-11
**狀態**: 待審核
